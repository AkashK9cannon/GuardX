<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Custom Browser UI</title>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Inter&display=swap");
      html,
      body {
        overflow-x: hidden;
      }

      body {
        width: 100%;
        font-family: "Inter", sans-serif;
        background: #fff;
        color: #000;
        -webkit-user-select: none;
        user-select: none;
        margin: 0;
        padding: 0;
      }
      #Logo {
        width: 30px;
        height: 30px;
      }
      #TabsBar {
        display: flex;
        align-items: center;
        background-color: rgba(80, 80, 80, 0.1);
        width: 100%;
        padding: 0 8px;
        gap: 8px;
        border-bottom: 0.1px solid rgba(80, 80, 80, 0.3);
        overflow: hidden;
      }

      #tabbar-wrapper {
        display: flex;
        align-items: center;
        overflow-x: auto;
        flex: 1;
        gap: 4px;
        /* border: 1px solid black; */
      }
      #TabWrap {
        border: 1px solid black;
        display: flex;
      }
      #tabbar {
        display: flex;
        align-items: center;
        gap: 4px;
        border: 1px solid black;
        min-width: 21vw;
        max-width: 85vw;
        padding-left: 8px;
      }

      .Tabbar_Btn {
        width: 36px;
        height: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
        border: none;
        background: none;
      }
      #TabsBarControls {
        display: flex;
        justify-self: flex-end;
      }
      #TabsBarControls button {
        border: none;
        background: none;
        height: 36px;
        width: 36px;
      }
      #TabsBarControls button:hover {
        background: rgba(0, 0, 0, 0.1);
      }
      .Tabbar_Btn:hover {
        background-color: rgba(80, 80, 80, 0.3);
      }
      .tab {
        display: flex;
        align-items: center;
        background: rgba(0, 0, 0, 0.1);
        color: black;
        height: 30px;
        border-radius: 6px 6px 0 0;
        font-size: 13px;
        cursor: pointer;
        flex-shrink: 0;
        white-space: nowrap;
        transition: background-color 0.2s;
        padding: 0 10px;
      }

      .tab.active {
        background: rgba(255, 255, 255, 0.6);
        box-shadow: inset 0 -3px 0 #1976d2;
        font-weight: bold;
        color: black;
      }

      .tab .close {
        margin-left: 8px;
        cursor: pointer;
        color: #ccc;
      }

      .tab .close:hover {
        color: white;
      }

      #AddTab {
        margin-left: 8px;
        background: none;
        border: none;
        cursor: pointer;
        padding: 0;
      }

      .TabBar_Icon {
        width: 28px;
        height: 28px;
      }

      #toolbar {
        width: 100%;
        display: flex;
        align-items: center;
        height: 36px;
        padding: 3px;
        gap: 20px;
        background: #fff;
        border-bottom: 0.3px solid rgba(80, 80, 80, 0.3);
      }

      #toolbar1 button:hover,
      #toolbar2 button:hover {
        background: rgba(0, 0, 0, 0.3);
      }
      #toolbar1,
      #toolbar2 {
        display: flex;
        gap: 10px;
      }
      #toolbar1 button,
      #toolbar2 button {
        width: 36px;
        height: 36px;
        border: none;
        background: none;
      }
      #urlbar {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 80vw;
        gap: 3px;
        border: 1px solid rgba(0, 0, 0, 0.3);
        border-radius: 30px;
        padding: 2px;
      }
      #urlbar button {
        width: 30px;
        height: 30px;
        background: none;
        border: none;
        padding: 3px;
      }
      #urlbar button:hover {
        background: rgba(0, 0, 0, 0.1);
        border-radius: 50%;
      }
      #urlInput {
        display: flex;
        align-items: center;
        flex: 1;
        width: 50vw;
        height: 24px;
        padding: 1px 0 1px 10px;
        font-size: 16px;
        border: none;
        outline: none;
        background: rgba(255, 255, 255, 0.6);
        color: #000;
        user-select: text;
        transition: box-shadow 0.3s ease;
      }

      /* Scrollbar styling for tabbar */
      #tabbar-wrapper::-webkit-scrollbar {
        height: 6px;
      }
      #tabbar-wrapper::-webkit-scrollbar-thumb {
        background: #aaa;
        border-radius: 3px;
      }
      #tabbar-wrapper::-webkit-scrollbar-track {
        background: transparent;
      }
      #TabsBar {
        display: flex;
      }
      .icons {
        width: 20px;
        height: 20px;
        color: rgba(0, 0, 0, 0.3);
      }
      .icons:hover {
        background: rgba(0, 0, 0, 0.1);
        border-radius: 50%;
      }
      .TabBar_Icon {
        width: 30px;
        height: 30px;
      }
    </style>
  </head>
  <body>
    <div id="TabsBar">
      <img src="./sysMedia/images/logo/lwthbg.png" id="Logo" alt="" />

      <div id="TabWrap">
        <div id="tabbar" style="display: flex; gap: 4px"></div>
        <button id="AddTab" class="Tabbar_Btn" onclick="newTab()">
          <img class="TabBar_Icon" src="./sysMedia/icons/Add.png" alt="" />
        </button>
      </div>

      <div id="TabsBarControls">
        <button id="Minimize">
          <img src="./sysMedia/icons/Minimize.png" id="minimize" alt="" />
        </button>
        <button id="Maximize"><img src="" id="" alt="" /></button>
        <button id="CloseBtn" onclick="closeApp()">
          <img src="./sysMedia/icons/Close.png" alt="" />
        </button>
      </div>
    </div>

    <div id="toolbar">
      <div id="toolbar1">
        <button onclick="goBack()">
          <img src="./sysMedia/icons/BackArrow.png" class="icons" alt="" />
        </button>
        <button onclick="goForward()">
          <img src="./sysMedia/icons/Forward.png" class="icons" alt="" />
        </button>
        <button onclick="goForward()">
          <img src="./sysMedia/icons/reload.png" class="icons" alt="" />
        </button>
      </div>
      <div id="urlbar">
        <button id="">
          <img src="./sysMedia/icons/info.png" alt="" />
        </button>
        <input id="urlInput" placeholder="Search or enter a web address" />
        <button id="">
          <img src="./sysMedia/icons/Star.png" class="icons" id="" alt="" />
        </button>
        <button onclick="navigate()">
          <img src="./sysMedia/icons/Search.png" class="icons" alt="" />
        </button>
      </div>
      <div id="toolbar2">
        <button id="minimize">
          <img
            src="./sysMedia/icons/Downloads.png"
            class="icons"
            id=""
            alt=""
          />
        </button>
        <button id="">
          <img
            src="./sysMedia/icons/Extension.png"
            class="icons"
            id=""
            alt=""
          />
        </button>
        <button id="">
          <img src="./sysMedia/icons/Account.png" class="icons" id="" alt="" />
        </button>
      </div>
    </div>

    <script>
      let activeIndex = 0;
      let tabCount = 0;
      let Tabs = []; // global tab object

      function closeApp() {
        window.electronAPI.closeapp();
      }

      function navigate() {
        const url = document.getElementById("urlInput").value;
        window.electronAPI.navigate(url);
      }

      function newTab() {
        window.electronAPI.newTab();
      }

      function switchTab(index) {
        activeIndex = index;
        window.electronAPI.switchTab(index);
      }

      function closeTab(index, event) {
        event.stopPropagation();
        window.electronAPI.closeTab(index);
      }

      function goBack() {
        window.electronAPI.goBack();
      }

      function goForward() {
        window.electronAPI.goForward();
      }

      const TabWrap = document.getElementById("TabWrap");
      const tabbar = document.getElementById("tabbar");
      const addBtn = document.getElementById("AddTab");
      const Tbw = 90;
      TabWrap.style.width = Tbw + "vw";

      console.log(Tabs);
      console.log(`Total tabs`, Tabs.length);

      function updateTabBar(tabs) {
        tabbar.innerHTML = "";
        tabCount = tabs.length;
        Tabs = []; // üîÅ Clear the global Tabs array

        const tabWidth = tabCount <= 4 ? (Tbw / 4) - 3 : (Tbw / tabCount)-3;

        tabs.forEach((tab, i) => {
          const id = `tab-${i + 1}`;
          Tabs.push({ id: id, tab }); // üîÅ Rebuild Tabs cleanly

          const tabDiv = document.createElement("div");
          tabDiv.className = "tab";
          tabDiv.id = id;
          tabDiv.style.width = `${tabWidth}vw`;

          if (tab.index === activeIndex) tabDiv.classList.add("active");

          tabDiv.textContent = tab.title;
          tabDiv.onclick = () => switchTab(tab.index);

          const closeBtn = document.createElement("span");
          closeBtn.className = "close";
          closeBtn.textContent = "√ó";
          closeBtn.onclick = (e) => closeTab(tab.index, e);
          tabDiv.appendChild(closeBtn);

          tabbar.appendChild(tabDiv);
        });

        tabbar.appendChild(addBtn);
      }

      window.electronAPI.onUpdateTabs((tabs) => {
        updateTabBar(tabs);
      });

      window.electronAPI.onActiveTab((index) => {
        activeIndex = index;
      });

      document.getElementById("urlInput").addEventListener("keydown", (e) => {
        if (e.key === "Enter") navigate();
      });
    </script>
  </body>
</html>
